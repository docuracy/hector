<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>HECTOR Vocabulary SPA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/@andypf/json-viewer@2.2.0/coverage/lcov-report/base.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/index.css">

    <script src="https://cdn.jsdelivr.net/npm/@andypf/json-viewer@2.2.0/dist/iife/index.min.js"></script>
    <script src="./js/phonemize.js"></script> <!-- UMD built from https://github.com/hans00/phonemize-->

</head>

<body>
<div class="container my-4">
    <h1 class="mb-3">HECTOR Vocabulary (under development)</h1>
    <p class="lead">Historical Economic Commodities: Terminologies, Ontologies, and Rates</p>

    <h2 class="mt-4">Intended Functionality</h2>
    <ul>
        <li>Serve a <strong>Dexie.js</strong>-backed searchable index of HECTOR terms.</li>
        <li>Support <strong>phonetic and orthographic searches</strong> across the vocabulary, using <a target="_blank" href="https://www.fusejs.io/">Fuse</a>.</li>
        <li>Provide dynamic lookup of concepts, contexts, and canonical forms.</li>
        <li>Integrate with JSON-LD and RDF representations via content negotiation.</li>
    </ul>

    <p>Requests are routed here from <code>https://w3id.org/hector/</code> (unless JSON-LD or RDF content type is
        requested).</p>

    <p>Requested path: <code id="path">none</code></p>

    <!-- JSON output card -->
    <div class="card mt-3">
        <div class="card-header">HECTOR JSON Data</div>
        <div class="card-body" id="json-container"></div>
    </div>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const path = params.get('path');
    document.getElementById('path').textContent = path || '(no path)';

    if (path) {
        const item = path.split('/').pop();
        const itemIPA = phonemize.phonemize(item, {language: 'en', strip: true});
        document.getElementById('path').textContent += ` (IPA: /${itemIPA}/)`;

        const jsonUrl = `https://w3id.org/hector/${path}`;
        fetch(jsonUrl, {headers: {Accept: 'application/json'}})
            .then(response => {
                if (response.status === 404) {
                    console.warn(`HTTP error 404. Using blank data.`);
                    return {};
                }
                if (!response.ok) {
                    // For any other non-2xx status code, throw a real error
                    throw new Error(`HTTP error ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                const jsonViewer = document.createElement("andypf-json-viewer");
                jsonViewer.id = "json";
                jsonViewer.expanded = 2;
                jsonViewer.indent = 4;
                jsonViewer.showDataTypes = true;
                jsonViewer.theme = "google-light";
                jsonViewer.showToolbar = true;
                jsonViewer.showSize = true;
                jsonViewer.showCopy = true;
                jsonViewer.expandIconType = "square";
                jsonViewer.data = data;

                const container = document.getElementById('json-container');
                container.appendChild(jsonViewer);
            })
            .catch(err => console.error('Error fetching JSON-LD:', err));
    }
</script>

<!-- Optional Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
